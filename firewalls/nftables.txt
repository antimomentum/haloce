table ip raw {
	chain ctest2 {
		meta l4proto udp udp sport 0 counter packets 0 bytes 0 drop
		meta l4proto != udp counter packets 0 bytes 0 drop
		counter packets 0 bytes 0 # add-set TEST1 src exist
		counter packets 0 bytes 0 # add-set TEST2 src exist
		# u32 "0x1c=0xfefe0100" counter packets 0 bytes 0 # add-set LEGIT src,src exist
		# match-set LEGIT src,src counter packets 0 bytes 0 accept
		# u32 "0x1c=0x5c717565" counter packets 0 bytes 0 accept
		# u32 "0x2a=0x1333360c" counter packets 0 bytes 0 accept
		# u32 "0x22&0xffffff=0xffffff" counter packets 0 bytes 0 accept
		counter packets 0 bytes 0 drop
	}

	chain pcheck {
		meta l4proto udp udp sport 0 counter packets 0 bytes 0 drop
		meta l4proto != udp counter packets 0 bytes 0 drop
		counter packets 0 bytes 0 # add-set TEST1 src exist
		# u32 "0x2a=0x1333360c" counter packets 0 bytes 0 accept
		# match-set TEST2 src counter packets 0 bytes 0 jump ctest2
		# u32 "0x1c=0x5c717565" counter packets 0 bytes 0 jump ctest2
		# u32 ! "0x22&0xffffff=0xffffff" counter packets 0 bytes 0 drop
		counter packets 0 bytes 0 # add-set TEST2 src exist
		counter packets 0 bytes 0 accept
	}

	chain madmins {
		ip saddr 34.197.71.170 counter packets 0 bytes 0 accept
		ip saddr 54.82.252.156 counter packets 0 bytes 0 accept
		meta l4proto tcp counter packets 0 bytes 0 accept
		meta l4proto udp counter packets 0 bytes 0 jump pcheck
	}

	chain PREROUTING {
		type filter hook prerouting priority raw; policy accept;
		iifname "eth0" # match-set LEGIT src,src counter packets 0 bytes 0 accept
		iifname "eth0" # match-set TEST1 src counter packets 0 bytes 0 jump pcheck
		iifname "eth0" # match-set MDNS src counter packets 0 bytes 0 jump madmins
		iifname "eth0" meta l4proto != udp counter packets 2 bytes 104 drop
		iifname "eth0" meta length 67 # u32 "0x1c=0xfefe0100" counter packets 0 bytes 0 jump ctest2
		iifname "eth0" meta length != 34-48 counter packets 2 bytes 152 drop
		iifname "eth0" meta length 48 # u32 "0x23=0xa010308" counter packets 0 bytes 0 jump pcheck
		iifname "eth0" meta length != 34 counter packets 0 bytes 0 drop
		iifname "eth0" # u32 ! "0x1c=0x5c717565" counter packets 0 bytes 0 drop
		iifname "eth0" counter packets 0 bytes 0 jump ctest2
	}
}
table ip mangle {
	chain reconnect {
		counter packets 0 bytes 0 # del-set TEST1 src
		counter packets 0 bytes 0 # del-set LEGIT src,src
	}

	chain PREROUTING {
		type filter hook prerouting priority mangle; policy accept;
		iifname "eth0" # match-set LEGIT src,src counter packets 0 bytes 0 # add-set LEGIT src,src exist
		iifname "eth0" meta length 31 # match-set LEGIT src,src # u32 "0x1b&0xffffff=0xfefe68" counter packets 0 bytes 0 jump reconnect
	}
}
